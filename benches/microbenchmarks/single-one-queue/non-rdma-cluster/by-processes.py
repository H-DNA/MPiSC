import matplotlib.pyplot as plt
import os

# Ensure the output directory exists
output_dir = "non-rdma-cluster/all/by-processes/"
os.makedirs(output_dir, exist_ok=True)

# Data for processors and queue types - expanded to include processors 2-32
processors = [
    2,
    3,
    4,
    5,
    6,
    7,
    8,
    9,
    10,
    11,
    12,
    13,
    14,
    15,
    16,
    17,
    18,
    19,
    20,
    21,
    22,
    23,
    24,
    25,
    26,
    27,
    28,
    29,
    30,
    31,
    32,
]

# Data for different queues and metrics - updated with all data points
queue_data = {
    "SlotQueue": {
        "dequeue_throughput": [
            0.019855,
            0.0150605,
            0.0125021,
            0.0190015,
            0.0185252,
            0.0170514,
            0.0179597,
            0.0191678,
            0.0193584,
            0.01745,
            0.0171568,
            0.0183913,
            0.01861,
            0.0186798,
            0.0179315,
            0.0189096,
            0.0176574,
            0.0175146,
            0.0174836,
            0.0195289,
            0.0187733,
            0.0196128,
            0.0175159,
            0.0214073,
            0.0196461,
            0.0192884,
            0.0173907,
            0.019442,
            0.0190858,
            0.0195758,
            0.0177168,
        ],
        "dequeue_latency": [
            503.652,
            663.99,
            799.863,
            526.275,
            539.806,
            586.461,
            556.802,
            521.709,
            516.571,
            573.065,
            582.86,
            543.735,
            537.346,
            535.337,
            557.677,
            528.832,
            566.334,
            570.952,
            571.964,
            512.061,
            532.671,
            509.87,
            570.91,
            467.131,
            509.006,
            518.447,
            575.019,
            514.35,
            523.951,
            510.836,
            564.437,
        ],
        "enqueue_throughput": [
            0.0424948,
            0.0845586,
            0.12428,
            0.23078,
            0.25901,
            0.276735,
            0.326185,
            0.371975,
            0.37328,
            0.304151,
            0.341658,
            0.326603,
            0.374985,
            0.405671,
            0.416998,
            0.408926,
            0.354698,
            0.389938,
            0.419759,
            0.39879,
            0.426429,
            0.46412,
            0.38239,
            0.573905,
            0.469062,
            0.40612,
            0.301231,
            0.438029,
            0.39413,
            0.390848,
            0.298465,
        ],
        "enqueue_latency": [
            235.323,
            236.522,
            241.39,
            173.325,
            193.043,
            216.814,
            214.602,
            215.068,
            241.106,
            328.784,
            321.959,
            367.418,
            346.68,
            345.108,
            359.714,
            391.269,
            479.28,
            461.612,
            452.641,
            501.518,
            492.462,
            474.015,
            601.48,
            418.188,
            532.978,
            640.204,
            896.321,
            639.227,
            735.797,
            767.562,
            1038.65,
        ],
        "total_throughput": [
            0.0397298,
            0.0301511,
            0.0250293,
            0.038079,
            0.0371429,
            0.0341369,
            0.0359373,
            0.0384889,
            0.0388717,
            0.0350746,
            0.0343307,
            0.0369297,
            0.0372386,
            0.0375091,
            0.0359527,
            0.0379705,
            0.0353678,
            0.0351693,
            0.0350896,
            0.0394484,
            0.0376968,
            0.039461,
            0.035242,
            0.0429858,
            0.0397834,
            0.0388468,
            0.0352336,
            0.0390395,
            0.0384578,
            0.0395431,
            0.035841,
        ],
    },
    "LTQueue": {
        "dequeue_throughput": [
            0.0084325,
            0.00596616,
            0.00544092,
            0.0053428,
            0.00460047,
            0.00429932,
            0.00400879,
            0.00415452,
            0.00398464,
            0.00392791,
            0.00362874,
            0.00364691,
            0.0037159,
            0.00374249,
            0.00349521,
            0.00345512,
            0.00344531,
            0.00317491,
            0.00296483,
            0.00324201,
            0.00316481,
            0.00323006,
            0.00308533,
            0.0032693,
            0.00314244,
            0.00294865,
            0.00307777,
            0.00296181,
            0.00313044,
            0.00309682,
            0.00306164,
        ],
        "dequeue_latency": [
            1185.89,
            1676.12,
            1837.92,
            1871.68,
            2173.69,
            2325.95,
            2494.52,
            2407.02,
            2509.64,
            2545.88,
            2755.78,
            2742.05,
            2691.14,
            2672.02,
            2861.06,
            2894.26,
            2902.5,
            3149.69,
            3372.88,
            3084.51,
            3159.75,
            3095.92,
            3241.14,
            3058.76,
            3182.24,
            3391.39,
            3249.11,
            3376.31,
            3194.44,
            3229.11,
            3266.22,
        ],
        "enqueue_throughput": [
            0.00870271,
            0.0104207,
            0.0128728,
            0.0135611,
            0.0126333,
            0.0134624,
            0.0137468,
            0.0152501,
            0.0150931,
            0.0160206,
            0.0164431,
            0.0164137,
            0.0175306,
            0.017908,
            0.0168374,
            0.0173257,
            0.0177165,
            0.0163264,
            0.0131475,
            0.0159362,
            0.0160238,
            0.017089,
            0.0163145,
            0.0181669,
            0.0158711,
            0.0137886,
            0.0164256,
            0.013107,
            0.014102,
            0.0145978,
            0.0135896,
        ],
        "enqueue_latency": [
            1149.07,
            1919.26,
            2330.49,
            2949.62,
            3957.8,
            4456.87,
            5092.1,
            5245.85,
            5963,
            6241.98,
            6689.74,
            7310.95,
            7415.59,
            7817.75,
            8908.74,
            9234.84,
            9595.57,
            11025.1,
            14451.4,
            12550,
            13105.5,
            12873.8,
            14097.9,
            13210.8,
            15751.9,
            18856.2,
            16437.8,
            21362.6,
            20564.4,
            20551.1,
            22811.5,
        ],
        "total_throughput": [
            0.0168734,
            0.0119443,
            0.0108927,
            0.010707,
            0.00922394,
            0.00860723,
            0.00802159,
            0.00834227,
            0.00800115,
            0.0078951,
            0.00726111,
            0.007323,
            0.00743552,
            0.00751491,
            0.00700789,
            0.00693787,
            0.00690095,
            0.00637522,
            0.00595041,
            0.00654886,
            0.00635494,
            0.00649887,
            0.00620769,
            0.00656474,
            0.00636345,
            0.00593857,
            0.00623555,
            0.00594731,
            0.00630784,
            0.00625559,
            0.00619369,
        ],
    },
    "FastQueue": {
        "dequeue_throughput": [
            0.0257165,
            0.0456991,
            0.0798942,
            0.0682508,
            0.0777738,
            0.0977125,
            0.100278,
            0.115094,
            0.123951,
            0.142703,
            0.147627,
            0.123424,
            0.100852,
            0.152639,
            0.119227,
            0.161051,
            0.153145,
            0.162336,
            0.137029,
            0.133099,
            0.161777,
            0.13297,
            0.158636,
            0.131312,
            0.0986306,
            0.13411,
            0.1468,
            0.123576,
            0.185334,
            0.126846,
            0.140223,
        ],
        "dequeue_latency": [
            388.856,
            218.823,
            125.166,
            146.518,
            128.578,
            102.341,
            99.7226,
            86.8858,
            80.677,
            70.0758,
            67.7384,
            81.0212,
            99.155,
            65.514,
            83.8734,
            62.092,
            65.2976,
            61.6008,
            72.9774,
            75.132,
            61.8134,
            75.2048,
            63.0374,
            76.1546,
            101.388,
            74.5658,
            68.1198,
            80.9218,
            53.9566,
            78.836,
            71.3148,
        ],
        "enqueue_throughput": [
            0.0255805,
            0.0482422,
            0.0855643,
            0.0885652,
            0.0945081,
            0.113823,
            0.117064,
            0.147015,
            0.154137,
            0.168878,
            0.171141,
            0.162512,
            0.13077,
            0.190743,
            0.148454,
            0.214172,
            0.193391,
            0.201506,
            0.1681,
            0.176801,
            0.207118,
            0.17105,
            0.197956,
            0.170229,
            0.126388,
            0.167779,
            0.182028,
            0.155794,
            0.234447,
            0.156832,
            0.168297,
        ],
        "enqueue_latency": [
            390.922,
            414.574,
            350.613,
            451.645,
            529.055,
            527.132,
            597.966,
            544.16,
            583.895,
            592.143,
            642.744,
            738.405,
            994.11,
            733.974,
            1010.41,
            747.064,
            879.047,
            893.274,
            1130.28,
            1131.21,
            1013.92,
            1286.17,
            1161.88,
            1409.87,
            1978.04,
            1549.65,
            1483.29,
            1797.24,
            1236.95,
            1912.88,
            1841.98,
        ],
        "total_throughput": [
            0.0511355,
            0.0902524,
            0.159948,
            0.132919,
            0.149867,
            0.188382,
            0.191684,
            0.217969,
            0.236607,
            0.26596,
            0.276049,
            0.237391,
            0.198771,
            0.292543,
            0.234219,
            0.314325,
            0.290839,
            0.307671,
            0.261725,
            0.258883,
            0.308069,
            0.260445,
            0.30477,
            0.252393,
            0.18854,
            0.254172,
            0.276691,
            0.231144,
            0.350175,
            0.237619,
            0.256612,
        ],
    },
    "SlotqueueV2a": {
        "dequeue_throughput": [
            0.0196739,
            0.0164717,
            0.0168938,
            0.0192326,
            0.0184257,
            0.0174758,
            0.0178066,
            0.0193383,
            0.0203116,
            0.0191513,
            0.0173644,
            0.0189511,
            0.019053,
            0.019542,
            0.0183694,
            0.0191878,
            0.0190366,
            0.0180826,
            0.0179817,
            0.0201584,
            0.0197846,
            0.0188676,
            0.0184149,
            0.0219297,
            0.020576,
            0.0200135,
            0.0191582,
            0.0199173,
            0.0201707,
            0.0204907,
            0.0192443,
        ],
        "dequeue_latency": [
            508.287,
            607.102,
            591.934,
            519.951,
            542.72,
            572.22,
            561.59,
            517.109,
            492.328,
            522.157,
            575.892,
            527.675,
            524.852,
            511.719,
            544.383,
            521.166,
            525.304,
            553.016,
            556.121,
            496.07,
            505.444,
            530.009,
            543.037,
            456.003,
            486.003,
            499.663,
            521.97,
            502.076,
            495.769,
            488.025,
            519.635,
        ],
        "enqueue_throughput": [
            0.0417738,
            0.085309,
            0.133287,
            0.230868,
            0.258917,
            0.277063,
            0.310932,
            0.360893,
            0.396423,
            0.412349,
            0.397264,
            0.327826,
            0.409733,
            0.48253,
            0.390669,
            0.42207,
            0.455352,
            0.476007,
            0.3839,
            0.40668,
            0.475872,
            0.340924,
            0.478333,
            0.491003,
            0.517823,
            0.428566,
            0.349693,
            0.473683,
            0.386761,
            0.472343,
            0.309686,
        ],
        "enqueue_latency": [
            239.384,
            234.442,
            225.079,
            173.259,
            193.112,
            216.557,
            225.13,
            221.672,
            227.03,
            242.513,
            276.894,
            366.047,
            317.28,
            290.137,
            383.957,
            379.084,
            373.337,
            378.146,
            494.92,
            491.787,
            441.295,
            645.305,
            480.836,
            488.795,
            482.79,
            606.675,
            772.105,
            591.112,
            749.817,
            635.131,
            1001.01,
        ],
        "total_throughput": [
            0.0393676,
            0.0329763,
            0.0338214,
            0.0385421,
            0.0369435,
            0.0349865,
            0.035631,
            0.0388313,
            0.0407858,
            0.0384942,
            0.0347461,
            0.0380537,
            0.0381251,
            0.0392403,
            0.0368307,
            0.038529,
            0.0381303,
            0.03631,
            0.0360892,
            0.0407201,
            0.0397274,
            0.0379616,
            0.0370509,
            0.0440348,
            0.0416664,
            0.0403072,
            0.0388145,
            0.0399939,
            0.0406439,
            0.0413913,
            0.0389311,
        ],
    },
    "SlotqueueV2b": {
        "dequeue_throughput": [
            0.0122171,
            0.0176895,
            0.01519,
            0.0264852,
            0.0238977,
            0.0237679,
            0.0233578,
            0.0245466,
            0.0265055,
            0.0239825,
            0.022196,
            0.0226727,
            0.024585,
            0.0241201,
            0.0226532,
            0.0234986,
            0.0249382,
            0.0244777,
            0.0230784,
            0.0245552,
            0.0248472,
            0.0228138,
            0.0237053,
            0.028619,
            0.0265071,
            0.0250537,
            0.020737,
            0.0234155,
            0.0229946,
            0.0263863,
            0.0257091,
        ],
        "dequeue_latency": [
            818.522,
            565.309,
            658.327,
            377.569,
            418.45,
            420.736,
            428.123,
            407.388,
            377.281,
            416.97,
            450.531,
            441.06,
            406.753,
            414.592,
            441.438,
            425.557,
            400.991,
            408.535,
            433.306,
            407.246,
            402.46,
            438.331,
            421.846,
            349.419,
            377.258,
            399.143,
            482.229,
            427.067,
            434.885,
            378.985,
            388.967,
        ],
        "enqueue_throughput": [
            0.0121727,
            0.0413154,
            0.0662473,
            0.0798823,
            0.0898971,
            0.10522,
            0.113078,
            0.134883,
            0.159795,
            0.137825,
            0.132818,
            0.124249,
            0.143959,
            0.14942,
            0.13925,
            0.147654,
            0.178613,
            0.191379,
            0.146285,
            0.149665,
            0.165885,
            0.143026,
            0.164736,
            0.213726,
            0.184758,
            0.156022,
            0.109512,
            0.151355,
            0.127075,
            0.181281,
            0.159911,
        ],
        "enqueue_latency": [
            821.507,
            484.081,
            452.848,
            500.737,
            556.191,
            570.231,
            619.041,
            593.108,
            563.222,
            725.558,
            828.199,
            965.806,
            903.037,
            936.954,
            1077.2,
            1083.62,
            951.78,
            940.544,
            1298.83,
            1336.32,
            1265.94,
            1538.18,
            1396.17,
            1122.93,
            1353.12,
            1666.43,
            2465.48,
            1849.96,
            2282.11,
            1654.89,
            1938.58,
        ],
        "total_throughput": [
            0.0243333,
            0.0354143,
            0.0304104,
            0.0530764,
            0.047915,
            0.0475833,
            0.0467389,
            0.0492896,
            0.053223,
            0.0482049,
            0.0444143,
            0.0455267,
            0.0491945,
            0.0484331,
            0.0454197,
            0.0471852,
            0.0499513,
            0.0491512,
            0.0463183,
            0.0496014,
            0.0498932,
            0.0459014,
            0.0476951,
            0.0574669,
            0.0536768,
            0.0504582,
            0.0420132,
            0.0470184,
            0.0463341,
            0.0533003,
            0.0520096,
        ],
    },
    "SlotqueueV2bc": {
        "dequeue_throughput": [
            0.0121158,
            0.0349653,
            0.0345788,
            0.0445771,
            0.0709527,
            0.0799974,
            0.0724905,
            0.0749092,
            0.0693181,
            0.0827758,
            0.0829833,
            0.0607523,
            0.0834601,
            0.0868832,
            0.0682907,
            0.09021,
            0.0730096,
            0.0691886,
            0.0545308,
            0.0735945,
            0.0793151,
            0.0752943,
            0.0782768,
            0.0872358,
            0.063587,
            0.0630167,
            0.0604516,
            0.0714155,
            0.0581318,
            0.0796167,
            0.0695964,
        ],
        "dequeue_latency": [
            825.368,
            285.998,
            289.195,
            224.331,
            140.939,
            125.004,
            137.949,
            133.495,
            144.262,
            120.808,
            120.506,
            164.603,
            119.818,
            115.097,
            146.433,
            110.852,
            136.968,
            144.532,
            183.383,
            135.88,
            126.079,
            132.812,
            127.752,
            114.632,
            157.265,
            158.688,
            165.422,
            140.026,
            172.023,
            125.602,
            143.686,
        ],
        "enqueue_throughput": [
            0.0120772,
            0.0415526,
            0.0657768,
            0.0587594,
            0.087201,
            0.0953916,
            0.102061,
            0.121756,
            0.11837,
            0.136063,
            0.146065,
            0.116734,
            0.166217,
            0.175519,
            0.128823,
            0.190282,
            0.152898,
            0.12563,
            0.100061,
            0.162376,
            0.156938,
            0.149184,
            0.16467,
            0.190729,
            0.124661,
            0.120849,
            0.115276,
            0.142668,
            0.116474,
            0.161381,
            0.139032,
        ],
        "enqueue_latency": [
            828.01,
            481.317,
            456.088,
            680.742,
            573.388,
            628.986,
            685.862,
            657.052,
            760.329,
            734.955,
            753.088,
            1027.98,
            782.109,
            797.633,
            1164.39,
            840.855,
            1111.85,
            1432.78,
            1898.83,
            1231.71,
            1338.11,
            1474.69,
            1396.73,
            1258.33,
            2005.44,
            2151.45,
            2342.2,
            1962.6,
            2489.83,
            1858.95,
            2229.7,
        ],
        "total_throughput": [
            0.0241422,
            0.0700004,
            0.0692267,
            0.0870623,
            0.138862,
            0.15407,
            0.145053,
            0.150418,
            0.139191,
            0.166379,
            0.16605,
            0.121991,
            0.167004,
            0.174462,
            0.136923,
            0.181142,
            0.146238,
            0.138931,
            0.109443,
            0.148661,
            0.159265,
            0.151492,
            0.157493,
            0.17517,
            0.128764,
            0.126916,
            0.122475,
            0.143402,
            0.117135,
            0.160826,
            0.140794,
        ],
    },
    "SlotqueueV2c": {
        "dequeue_throughput": [
            0.0317628,
            0.0243165,
            0.0229881,
            0.042945,
            0.0429797,
            0.0385243,
            0.0384986,
            0.0422463,
            0.0417385,
            0.043299,
            0.0399586,
            0.0390795,
            0.0419244,
            0.0421295,
            0.0374141,
            0.0414092,
            0.0393813,
            0.0414423,
            0.0334699,
            0.0417188,
            0.0417382,
            0.0400752,
            0.0388559,
            0.0452897,
            0.0391881,
            0.0380089,
            0.0414967,
            0.0363116,
            0.0371135,
            0.037988,
            0.0395592,
        ],
        "dequeue_latency": [
            314.834,
            411.243,
            435.007,
            232.856,
            232.668,
            259.577,
            259.75,
            236.707,
            239.587,
            230.952,
            250.259,
            255.889,
            238.525,
            237.364,
            267.279,
            241.492,
            253.927,
            241.3,
            298.776,
            239.7,
            239.588,
            249.531,
            257.361,
            220.801,
            255.18,
            263.097,
            240.983,
            275.394,
            269.443,
            263.241,
            252.786,
        ],
        "enqueue_throughput": [
            0.04163,
            0.0849529,
            0.138489,
            0.224695,
            0.25561,
            0.27296,
            0.309953,
            0.358617,
            0.368691,
            0.408235,
            0.406504,
            0.344652,
            0.398744,
            0.445696,
            0.314936,
            0.464082,
            0.415423,
            0.42752,
            0.259534,
            0.418005,
            0.396428,
            0.422022,
            0.482956,
            0.523675,
            0.370259,
            0.349453,
            0.437687,
            0.36609,
            0.325575,
            0.343835,
            0.387972,
        ],
        "enqueue_latency": [
            240.211,
            235.425,
            216.624,
            178.019,
            195.61,
            219.813,
            225.84,
            223.079,
            244.107,
            244.957,
            270.6,
            348.178,
            326.024,
            314.115,
            476.288,
            344.767,
            409.222,
            421.033,
            732.082,
            478.463,
            529.73,
            521.3,
            476.234,
            458.3,
            675.203,
            744.019,
            616.879,
            764.839,
            890.731,
            872.513,
            799.027,
        ],
        "total_throughput": [
            0.0635573,
            0.0486817,
            0.0460222,
            0.0860618,
            0.0861743,
            0.0771256,
            0.0770356,
            0.0848305,
            0.083811,
            0.0870309,
            0.0799571,
            0.0784716,
            0.0838906,
            0.084596,
            0.0750154,
            0.0831498,
            0.0788808,
            0.0832161,
            0.067174,
            0.084272,
            0.0838104,
            0.0806313,
            0.0781781,
            0.0909417,
            0.0793559,
            0.0765498,
            0.0840723,
            0.0729136,
            0.0747838,
            0.0767358,
            0.0800282,
        ],
    },
}

# Metrics to plot
metrics = [
    "dequeue_throughput",
    "dequeue_latency",
    "enqueue_throughput",
    "enqueue_latency",
    "total_throughput",
]

# Metric labels and units
metric_labels = {
    "dequeue_throughput": ("Dequeue Throughput", "10^5 ops/s"),
    "dequeue_latency": ("Dequeue Latency", "μs"),
    "enqueue_throughput": ("Enqueue Throughput", "10^5 ops/s"),
    "enqueue_latency": ("Enqueue Latency", "μs"),
    "total_throughput": ("Total Throughput", "10^5 ops/s"),
}

# Color and marker styles for each queue
queue_styles = {
    "SlotQueue": {"color": "blue", "marker": "o"},
    "LTQueue": {"color": "red", "marker": "s"},
    "FastQueue": {"color": "green", "marker": "^"},
    "SlotqueueV2a": {"color": "purple", "marker": "d", "linestyle": "--"},
    "SlotqueueV2b": {"color": "pink", "marker": "o", "linestyle": "--"},
    "SlotqueueV2bc": {"color": "black", "marker": "s", "linestyle": "--"},
    "SlotqueueV2c": {"color": "orange", "marker": "^", "linestyle": "--"},
}

# Generate merged plots for each metric
for metric in metrics:
    # Create a new figure for each metric
    plt.figure(figsize=(14, 8))

    # Plot data for each queue
    for queue_name, queue_metrics in queue_data.items():
        style = queue_styles[queue_name]
        plt.plot(
            processors,
            queue_metrics[metric],
            color=style["color"],
            marker=style["marker"],
            linestyle=style.get("linestyle", "-"),
            label=f"{queue_name}{'*' if queue_name == 'SlotqueueV2a' else ''}",
        )

    # Set title and labels
    title, unit = metric_labels[metric]
    plt.title(f"Comparative {title} Across Queue Implementations (2-32 Processors)")
    plt.xlabel("Number of Processors")
    plt.ylabel(f"{title} ({unit})")

    # Add grid and legend
    plt.grid(True)
    plt.legend(title="Queue Types", loc="best")

    # Add x-axis ticks for every processor count
    plt.xticks(processors)

    # Save the plot
    filename = f"{output_dir}/{metric}_comparison.png"
    plt.savefig(filename, dpi=300)
    plt.close()  # Close the figure to free up memory

print(
    "All comparative plots have been generated in the 'non-rdma-cluster/all/by-processes' folder."
)

# Ensure the output directory exists
output_dir = "non-rdma-cluster/no-ltqueue/by-processes/"
os.makedirs(output_dir, exist_ok=True)

# Generate merged plots for each metric
for metric in metrics:
    # Create a new figure for each metric
    plt.figure(figsize=(14, 8))

    # Plot data for each queue
    for queue_name, queue_metrics in queue_data.items():
        if queue_name != "LTQueue":
            style = queue_styles[queue_name]
            plt.plot(
                processors,
                queue_metrics[metric],
                color=style["color"],
                marker=style["marker"],
                linestyle=style.get("linestyle", "-"),
                label=f"{queue_name}{'*' if queue_name == 'SlotqueueV2a' else ''}",
            )

    # Set title and labels
    title, unit = metric_labels[metric]
    plt.title(f"Comparative {title} Across Queue Implementations (2-32 Processors)")
    plt.xlabel("Number of Processors")
    plt.ylabel(f"{title} ({unit})")

    # Add grid and legend
    plt.grid(True)
    plt.legend(title="Queue Types", loc="best")

    # Add x-axis ticks for every processor count
    plt.xticks(processors)

    # Save the plot
    filename = f"{output_dir}/{metric}_comparison.png"
    plt.savefig(filename, dpi=300)
    plt.close()  # Close the figure to free up memory

print(
    "All comparative plots have been generated in the 'non-rdma-cluster/no-ltqueue/by-processes' folder."
)

print(
    "Note: SlotqueueV2a is marked with an asterisk (*) in the legend to indicate it is experimental."
)
