import matplotlib.pyplot as plt
import os

# Ensure the output directory exists
output_dir = "non-rdma-cluster"
os.makedirs(output_dir, exist_ok=True)

# Data for processors and queue types - expanded to include processors 2-32
processors = [
    2,
    3,
    4,
    5,
    6,
    7,
    8,
    9,
    10,
    11,
    12,
    13,
    14,
    15,
    16,
    17,
    18,
    19,
    20,
    21,
    22,
    23,
    24,
    25,
    26,
    27,
    28,
    29,
    30,
    31,
    32,
]

# Data for different queues and metrics - updated with all data points
queue_data = {
    "SlotQueue": {
        "dequeue_throughput": [
            0.0229716,
            0.0186052,
            0.0176696,
            0.0216445,
            0.0203809,
            0.0191209,
            0.0219436,
            0.0207728,
            0.0207494,
            0.0210038,
            0.0195216,
            0.0210472,
            0.0191156,
            0.0208054,
            0.0207966,
            0.0212197,
            0.0204648,
            0.021031,
            0.0196217,
            0.0203275,
            0.0215009,
            0.0210335,
            0.0198486,
            0.0225824,
            0.0213227,
            0.0200024,
            0.0207311,
            0.0215177,
            0.0218482,
            0.0210382,
            0.0221266,
        ],
        "dequeue_latency": [
            435.321,
            537.484,
            565.945,
            462.011,
            490.654,
            522.988,
            455.713,
            481.399,
            481.942,
            476.104,
            512.254,
            475.123,
            523.133,
            480.645,
            480.848,
            471.26,
            488.645,
            475.489,
            509.641,
            491.945,
            465.097,
            475.431,
            503.814,
            442.823,
            468.983,
            499.941,
            482.367,
            464.734,
            457.704,
            475.326,
            451.946,
        ],
        "enqueue_throughput": [
            0.0339481,
            0.0587401,
            0.0938809,
            0.13441,
            0.156216,
            0.166759,
            0.211473,
            0.194212,
            0.258394,
            0.271946,
            0.238706,
            0.318166,
            0.21611,
            0.3031,
            0.236497,
            0.278924,
            0.249791,
            0.326426,
            0.217764,
            0.269402,
            0.271079,
            0.228658,
            0.203471,
            0.27568,
            0.297318,
            0.256979,
            0.275097,
            0.299305,
            0.284264,
            0.256819,
            0.285112,
        ],
        "enqueue_latency": [
            294.567,
            340.483,
            319.554,
            297.596,
            320.07,
            359.8,
            331.011,
            411.921,
            348.305,
            367.719,
            460.818,
            377.161,
            601.547,
            461.893,
            634.258,
            573.634,
            680.568,
            551.427,
            872.503,
            742.386,
            774.683,
            962.137,
            1130.38,
            870.573,
            840.851,
            1011.76,
            981.473,
            935.501,
            1020.18,
            1168.14,
            1087.29,
        ],
        "total_throughput": [
            0.0459661,
            0.0372476,
            0.0353744,
            0.0433756,
            0.0408638,
            0.0382801,
            0.0439092,
            0.0417117,
            0.0416648,
            0.0422176,
            0.0390626,
            0.0422627,
            0.0382503,
            0.0417772,
            0.0416972,
            0.0426092,
            0.0409909,
            0.0422302,
            0.0393807,
            0.0410615,
            0.0431738,
            0.0423195,
            0.0399354,
            0.0453454,
            0.0431785,
            0.0402847,
            0.0420012,
            0.0432075,
            0.0440241,
            0.0424971,
            0.044762,
        ],
    },
    "LTQueue": {
        "dequeue_throughput": [
            0.0106108,
            0.00742815,
            0.00657806,
            0.00631338,
            0.00552697,
            0.00482138,
            0.00501152,
            0.00433427,
            0.00452561,
            0.00462538,
            0.00417114,
            0.00403463,
            0.00386135,
            0.00434946,
            0.00400063,
            0.00409976,
            0.00396639,
            0.0041033,
            0.00372239,
            0.00385623,
            0.00384549,
            0.00319501,
            0.00349403,
            0.00353215,
            0.00386067,
            0.00352548,
            0.00358908,
            0.00376218,
            0.00377505,
            0.00376155,
            0.0038035,
        ],
        "dequeue_latency": [
            942.432,
            1346.23,
            1520.21,
            1583.94,
            1809.31,
            2074.09,
            1995.4,
            2307.19,
            2209.64,
            2161.98,
            2397.42,
            2478.54,
            2589.77,
            2299.14,
            2499.61,
            2439.17,
            2521.19,
            2437.06,
            2686.44,
            2593.21,
            2600.45,
            3129.88,
            2862.03,
            2831.14,
            2590.23,
            2836.49,
            2786.23,
            2658.04,
            2648.97,
            2658.48,
            2629.16,
        ],
        "enqueue_throughput": [
            0.0122646,
            0.012046,
            0.0138352,
            0.0147892,
            0.0149149,
            0.0145661,
            0.0163964,
            0.0159452,
            0.0178604,
            0.0194136,
            0.0186272,
            0.0188285,
            0.0181461,
            0.0226227,
            0.0180403,
            0.0205684,
            0.0202757,
            0.0230872,
            0.0186827,
            0.0208189,
            0.018563,
            0.0117814,
            0.0146921,
            0.0173022,
            0.0217509,
            0.0196836,
            0.0183527,
            0.0204643,
            0.0196072,
            0.0181211,
            0.0187541,
        ],
        "enqueue_latency": [
            815.356,
            1660.3,
            2168.37,
            2704.68,
            3352.36,
            4119.16,
            4269.23,
            5017.17,
            5039.09,
            5151.04,
            5905.34,
            6373.3,
            7164.07,
            6188.48,
            8314.71,
            7778.94,
            8384.41,
            7796.52,
            10169.8,
            9606.65,
            11312.8,
            18673.5,
            15654.7,
            13871,
            11493.8,
            13209,
            14711.7,
            13682.3,
            14790.5,
            16555.3,
            16529.7,
        ],
        "total_throughput": [
            0.0212323,
            0.0148712,
            0.0131693,
            0.012652,
            0.0110816,
            0.0096524,
            0.010028,
            0.00870321,
            0.00908743,
            0.00929702,
            0.00834646,
            0.00810153,
            0.00772657,
            0.00873371,
            0.00802125,
            0.00823231,
            0.00794467,
            0.00823942,
            0.00747084,
            0.00778958,
            0.00772175,
            0.00642837,
            0.00702998,
            0.00709256,
            0.00781785,
            0.00710032,
            0.00727147,
            0.00755445,
            0.00760672,
            0.00759833,
            0.00769448,
        ],
    },
    "FastQueue": {
        "dequeue_throughput": [
            0.0348379,
            0.0621497,
            0.0941999,
            0.0719515,
            0.0911213,
            0.102645,
            0.125979,
            0.127167,
            0.144687,
            0.149807,
            0.175432,
            0.130636,
            0.155663,
            0.16852,
            0.156286,
            0.163507,
            0.20156,
            0.191086,
            0.160734,
            0.161973,
            0.15536,
            0.0987264,
            0.177851,
            0.148064,
            0.183842,
            0.172573,
            0.163283,
            0.178541,
            0.178515,
            0.170136,
            0.178644,
        ],
        "dequeue_latency": [
            287.044,
            160.902,
            106.157,
            138.983,
            109.744,
            97.4234,
            79.3786,
            78.6368,
            69.1146,
            66.7526,
            57.0022,
            76.5488,
            64.2414,
            59.3402,
            63.9852,
            61.1596,
            49.613,
            52.3324,
            62.2146,
            61.7386,
            64.3666,
            101.29,
            56.2268,
            67.5384,
            54.3944,
            57.9464,
            61.2434,
            56.0096,
            56.0178,
            58.7764,
            55.9774,
        ],
        "enqueue_throughput": [
            0.0346323,
            0.0639536,
            0.0975546,
            0.0941764,
            0.111524,
            0.11971,
            0.155503,
            0.169369,
            0.177607,
            0.188536,
            0.212336,
            0.175911,
            0.203079,
            0.216062,
            0.195057,
            0.219888,
            0.265124,
            0.247831,
            0.201088,
            0.215361,
            0.202336,
            0.122246,
            0.222495,
            0.189927,
            0.239101,
            0.218106,
            0.205285,
            0.227756,
            0.225296,
            0.211939,
            0.219888,
        ],
        "enqueue_latency": [
            288.748,
            312.727,
            307.52,
            424.735,
            448.334,
            501.211,
            450.151,
            472.341,
            506.736,
            530.401,
            518.046,
            682.165,
            640.144,
            647.963,
            769.007,
            727.644,
            641.21,
            726.301,
            944.862,
            928.673,
            1037.88,
            1799.65,
            1033.73,
            1263.65,
            1045.58,
            1192.08,
            1315.24,
            1229.39,
            1287.19,
            1415.5,
            1409.81,
        ],
        "total_throughput": [
            0.06923,
            0.122792,
            0.184746,
            0.13897,
            0.175241,
            0.19638,
            0.241264,
            0.250875,
            0.271645,
            0.293625,
            0.339895,
            0.260185,
            0.307604,
            0.330347,
            0.30537,
            0.323982,
            0.396161,
            0.374119,
            0.311462,
            0.312598,
            0.301451,
            0.186652,
            0.341641,
            0.281672,
            0.355277,
            0.329737,
            0.311979,
            0.337004,
            0.3369,
            0.31974,
            0.334522,
        ],
    },
    "SlotqueueV2": {
        "dequeue_throughput": [
            0.0237635,
            0.0197364,
            0.0206059,
            0.0217856,
            0.0207482,
            0.0195973,
            0.022457,
            0.0212104,
            0.0212494,
            0.0203698,
            0.01982,
            0.0199861,
            0.0191283,
            0.021234,
            0.0209627,
            0.0215264,
            0.0202633,
            0.0210273,
            0.0204045,
            0.0213809,
            0.0220284,
            0.0217583,
            0.0203899,
            0.0231415,
            0.0223862,
            0.0205342,
            0.0212873,
            0.0219827,
            0.0218575,
            0.0221729,
            0.0223213,
        ],
        "dequeue_latency": [
            420.814,
            506.677,
            485.297,
            459.018,
            481.97,
            510.273,
            445.295,
            471.467,
            470.602,
            490.924,
            504.542,
            500.348,
            522.786,
            470.943,
            477.038,
            464.546,
            493.504,
            475.573,
            490.087,
            467.706,
            453.96,
            459.596,
            490.439,
            432.124,
            446.704,
            486.992,
            469.764,
            454.903,
            457.509,
            451,
            448.002,
        ],
        "enqueue_throughput": [
            0.0353919,
            0.0589163,
            0.0933154,
            0.136174,
            0.159052,
            0.169709,
            0.215156,
            0.191396,
            0.261132,
            0.263476,
            0.243732,
            0.237784,
            0.210655,
            0.299341,
            0.244987,
            0.287689,
            0.22362,
            0.358842,
            0.292074,
            0.285211,
            0.297936,
            0.22752,
            0.187651,
            0.281119,
            0.318783,
            0.289147,
            0.284197,
            0.299467,
            0.294548,
            0.273042,
            0.281641,
        ],
        "enqueue_latency": [
            282.55,
            339.465,
            321.49,
            293.741,
            314.363,
            353.546,
            325.345,
            417.981,
            344.654,
            379.541,
            451.316,
            504.659,
            617.121,
            467.694,
            612.277,
            556.156,
            760.217,
            501.613,
            650.52,
            701.234,
            704.849,
            966.949,
            1225.68,
            853.73,
            784.231,
            899.197,
            950.044,
            934.994,
            984.559,
            1098.73,
            1100.69,
        ],
        "total_throughput": [
            0.0475507,
            0.0395123,
            0.0412531,
            0.0436584,
            0.0416001,
            0.0392339,
            0.0449365,
            0.0425904,
            0.0426688,
            0.0409432,
            0.0396597,
            0.0401321,
            0.0382757,
            0.0426379,
            0.0420302,
            0.043225,
            0.0405873,
            0.0422228,
            0.0409519,
            0.0431895,
            0.044233,
            0.0437776,
            0.0410245,
            0.0464682,
            0.045332,
            0.0413559,
            0.0431281,
            0.0441413,
            0.0440429,
            0.0447893,
            0.0451561,
        ],
    },
}

# Metrics to plot
metrics = [
    "dequeue_throughput",
    "dequeue_latency",
    "enqueue_throughput",
    "enqueue_latency",
    "total_throughput",
]

# Metric labels and units
metric_labels = {
    "dequeue_throughput": ("Dequeue Throughput", "10^5 ops/s"),
    "dequeue_latency": ("Dequeue Latency", "μs"),
    "enqueue_throughput": ("Enqueue Throughput", "10^5 ops/s"),
    "enqueue_latency": ("Enqueue Latency", "μs"),
    "total_throughput": ("Total Throughput", "10^5 ops/s"),
}

# Color and marker styles for each queue
queue_styles = {
    "SlotQueue": {"color": "blue", "marker": "o"},
    "LTQueue": {"color": "red", "marker": "s"},
    "FastQueue": {"color": "green", "marker": "^"},
    "SlotqueueV2": {"color": "purple", "marker": "d", "linestyle": "--"},
}

# Generate merged plots for each metric
for metric in metrics:
    # Create a new figure for each metric
    plt.figure(figsize=(14, 8))

    # Plot data for each queue
    for queue_name, queue_metrics in queue_data.items():
        style = queue_styles[queue_name]
        plt.plot(
            processors,
            queue_metrics[metric],
            color=style["color"],
            marker=style["marker"],
            linestyle=style.get("linestyle", "-"),
            label=f"{queue_name}{'*' if queue_name == 'SlotqueueV2' else ''}",
        )

    # Set title and labels
    title, unit = metric_labels[metric]
    plt.title(f"Comparative {title} Across Queue Implementations (2-32 Processors)")
    plt.xlabel("Number of Processors")
    plt.ylabel(f"{title} ({unit})")

    # Add grid and legend
    plt.grid(True)
    plt.legend(title="Queue Types", loc="best")

    # Add x-axis ticks for every processor count
    plt.xticks(processors)

    # Save the plot
    filename = f"{output_dir}/{metric}_comparison.png"
    plt.savefig(filename, dpi=300)
    plt.close()  # Close the figure to free up memory

print("All comparative plots have been generated in the 'non-rdma-cluster' folder.")
print(
    "Note: SlotqueueV2 is marked with an asterisk (*) in the legend to indicate it is experimental."
)
